\documentclass[a4paper,11pt]{report}
%\pagestyle{headings}

\input{tex/preambule.tex}

\title{Cannonball of RC cars\\User guide}
\author{Thibaut Coutelou, Benjamin Mugnier, Guillaume Perrin}
\date{\today}

\begin{document}
\maketitle
\tableofcontents
%\listoffigures

\setlength{\parskip}{3mm}

%\begin{figure}[!ht]
%\begin{center}
%\includegraphics[width=\textwidth]{img/acteurs}
%\caption{Acteurs}
%\label{acteurs}
%\end{center}
%\end{figure}

%Quick reminder of latex :
%part
%chapter
%section
%subsection
%subsubsection
%paragraph

%Don't forget : set tw=79







\chapter{Quick starter guide}

\section{What do I need ?}

\section{How to plug ?}

Follow instructions on figure \ref{fig:wires}.

\begin{figure}[!ht]
\centering
\includegraphics[scale=0.5]{img_static/wires}
\caption{How to plug}
\label{fig:wires}
\end{figure}

\section{How to build the program ?}

\section{How to flash the Arduino ?}

There are two ways to flash the Arduino, the first one (and the simple one) is
to use the Arduino IDE\footnote{\url{http://arduino.cc/en/Main/Software\#toc1}}. After
download it, then open the project in.

In order to flash the Arduino, you need to select the model in \texttt{Tools >
Board} and the serial port in \texttt{Tools > Serial Port}, this is likely
\texttt{COM3} or higher on Windows and \texttt{/dev/tty.usbmodem} on Unix systems.
You can now flash the file on Arduino using the shortcut \texttt{upload} or in
the menu \texttt{File > Upload}. You will see \texttt{Upload done} if everything
went well.

If you're interesting of the other method, please refer to \ref{sec:Flashing}.

\section{How to get markers ?}

Marker recognition is based on highly reliable markers (hrm) from the arUco
library.

\subsection{Camera calibration}
\label{subsec:cam}

First, you need to calibrate the camera. In order to do that, \begin{itemize}

    \item Generate a board of markers with \texttt{aruco\_create\_board 4:5
        boardImageCalibration.png boardConfigurationCalibration.yml}.

    \item Print the png image. Mesure in meters the size of a marker.

    \item Convert the board configuration file from pixel to meters with
        \texttt{aruco\_boar\_pix2meters boardConfigurationCalibration.yml <size
        of marker in meters> boardConfigurationCalibrationMeters.yml}

    \item Calibrate the camera with \texttt{aruco\_calibration live
        boardConfigurationCalibrationMeters.yml cameraParams.yml}

\end{itemize}

\subsection{Creating hrm markers}
\label{subsec:dic}

You now need to create markers : \begin{itemize}

    \item Generate a dictionary of hrm markers with
        \texttt{aruco\_hrm\_create\_dictionary dict.yml <size of the
        dictionary> <marker size>}

    \item Generate the board with \texttt{aruco\_hrm\_create\_board dict.yml
        board.yml board.png heighr width}

    \item Print the board.

\end{itemize}



\section{How to get metrics ?}

\subsection{Setup a MQTT server}

You need an MQTT server to get the data. We recommend
Mosquitto\footnote{\url{http://mosquitto.org/download/}} which is available for every
platform. Note that it's available on Debian via a simple \texttt{apt-get install
mosquitto} and on OSX via \texttt{brew install mosquitto}. As Windows, you need to
download the server and then restart your computer for the service to launch (or ask the
service to launch manually), this is really important.

Then, you need the tablet to be on the same network as the server. You can
either create an hotspot via the tablet or the server, or connect both to an
existing network.  You need to tell the program the server's ip. Please refer
to the corresponding section.

\subsection{Display metrics in HTML}

The metrics are retrieve through a Node
server\footnote{\url{http://nodejs.org/}}. You can download via \texttt{apt-get
install node} on Debian, \texttt{brew install node} on OSX and on the
\href{http://nodejs.org}{official website} on Windows. You also need a mongo
server that you can find on Debian via \texttt{apt-get install mongodb}, on OSX
via \texttt{brew install mongodb} and for Windows on the
\href{http://www.mongodb.org/downloads}{official
website}\footnote{\url{http://www.mongodb.org/downloads}}, you can launch the
mongodb sever via the command \texttt{mongo --dbpath </path/to/the/db>}.

After install node, you need to install package dependencies by launching the
command \texttt{npm install} in the \emph{Mosquitto/subscriber} directory. You
also need to download \emph{Bootstrap 3} on the
\href{http://getbootstrap.com/}{official
website}\footnote{\url{http://getbootstrap.com}}, \emph{socket.io client} on
the \href{http://socket.io/download/}{official
website}\footnote{\url{http://socket.io/download/}} and \emph{Chart.js} on the
\href{http://www.chartjs.org/}{official
website}\footnote{\url{http://www.chartjs.org/}}

You are now able to launch the node server with the command \texttt{node
subscriber.js mqtt\_server\_address mqtt\_server\_port mongo\_port}. You can
now display the metrics in the web page \texttt{view.html}.

\section{How to launch the program ?}

The program is launched as usual by double-clicking the .exe, a console will
prompt. 
For more informations on how to build the .exe, please refer to ???.

\subsection{Arguments needed}

The executable needs several arguments. Otherwise, it will not launch and
prompt the program usage.
The program needs :

\begin{itemize}
    \item Path to dictionnary.yml, see~\ref{subsec:dic}.
    \item Path to intrinsics.yml, see~\ref{subsec:cam}.
    \item Marker size (in meters).
    \item The MQTT server IP for getting metrics.
    \item The Arduino serial port, should be something like 'COM5'.
    \item The mode to run (IA). Should be 'rabbit' to follow a marker, or 'cannon' for race mode.
\end{itemize}





\chapter{User guide}

\section{Building}

\section{Flashing}
\label{sec:Flashing} %Need in user quick guide->flash arduino

\section{Plugging}

\section{Markers}

\section{Monitoring}

\section{Implementing a new artificial intelligence}

\section{Android}

\end{document}
